import{d as U,r as X,b as $,y as Le,z as K,A as le,m as ie,B as ke,o as D,e as M,f as v,C as ne,n as R,k as a,t as ee,F as ue,v as F,l as J,D as Q,G as Be,g as C,H as be,I as de,s as ae,w as k,J as j,K as Ie,i as Se,L as Pe,M as Re,N as Fe,p as Ne,j as ze,O as Ae,P as We,a as Ve,q as De,Q as Xe,R as He,S as Oe,E as qe}from"./index.bc555423.js";import{u as fe,t as O,a as G}from"./source.4b31753f.js";import{_ as te}from"./_plugin-vue_export-helper.cdc0426e.js";const ge=e=>`${e?e+"-":""}${Math.ceil(Math.random()*1e6).toString(36)}-${Date.now().toString(36)}`,Te=Symbol("scroll-circle"),L="legendTD-scroll-circle",se=(e,o)=>{let t=e;return o&&Object.keys(o).forEach(s=>{t+=" "+(o[s]?e+"-"+s:"")}),t},Z=e=>{var o,t,s,n;return(n=(s=(o=e==null?void 0:e.touches)==null?void 0:o[0])!=null?s:(t=e==null?void 0:e.changedTouches)==null?void 0:t[0])!=null?n:e},Ye=(e,o,t)=>{let s=0,n=0;return e==="auto"?o?s=t:n=t:e==="left"?s=-t:e==="top"?n=-t:e==="right"?s=t:e==="bottom"&&(n=t),{x:s,y:n}},Ce=(e,o,t)=>{let s=1;return e==="auto"?s=o?1:-1:(e==="left"||e==="bottom"||e==="center")&&(s=-1),s*(t?-1:1)};function $e(e,o){const s=Math.atan2(e.y-o.y,e.x-o.x)*(180/Math.PI);return s<0?360+s:s}function Ue({changeDeg:e,cardDeg:o,deg:t}){let s="ceil";return Math.abs(e)<o/3?s=e<0?"ceil":"floor":s=e<0?"floor":"ceil",o*Math[s](t/o)}function je({centerPoint:e,isFlipDirection:o,isVertical:t}){let s=0,n=1,c=1,i=!1;return e==="left"?(s=-90,o||(c=-1,i=!0)):e==="top"?(s=180,n=o?-1:1):e==="right"||e==="auto"&&t?(s=90,o&&(c=-1,i=!0)):(e==="bottom"||e==="auto"&&!t||e==="center")&&(s=0,n=o?1:-1),{initDeg:s,nx:n,ny:c,isAddDeg:i}}const Ge=U({__name:"index",props:{listLength:{default:0},width:{default:"100%"},height:{default:"100%"},centerPoint:{default:"auto"},radius:{},circlePadding:{default:5},cardAddDeg:{default:1},initCartNum:{default:0},isAverage:{type:Boolean,default:!0},isFlipDirection:{type:Boolean,default:!1},isPagination:{type:Boolean,default:!0},leftArrow:{},rightArrow:{},disableTouch:{type:Boolean},onTouchStart:{},onTouchMove:{},onTouchEnd:{},onScrollEnd:{},onPageChange:{}},emits:["onPageChange","onTouchStart","onTouchMove","onTouchEnd","onScrollEnd"],setup(e,{emit:o}){var A,W,q,Y;const t=e,s=X(ge(L)),n=$({circleR:0,cardDeg:0,isVertical:((W=(A=document.querySelector(`.${s.value}`))==null?void 0:A.clientHeight)!=null?W:0)>((Y=(q=document.querySelector(`.${s.value}`))==null?void 0:q.clientWidth)!=null?Y:0),isFlipDirection:!!t.isFlipDirection,isClick:!1,centerPoint:t.centerPoint});Le(Te,n);const c=$({w:0,h:0,left:0,top:0}),i=$({x:0,y:0}),l=$({circleR:0,cardDeg:0}),x=$({startDeg:0,preDeg:0,isClick:!1,preRoundDeg:0,time:0}),d=X(0),m=$({pageNum:1,pageSize:10}),_=X(.6),f=K(()=>{const{x:h,y:g}=Ye(t.centerPoint,n.isVertical,l.circleR);return{width:`${l.circleR*2}px`,height:`${l.circleR*2}px`,transitionDuration:_.value+"ms",transform:`translate(calc(-50% + ${h}px), calc(-50% + ${g}px)) rotate(${d.value}deg)`}});le(()=>t.listLength,()=>{r()}),le(()=>n.isVertical,()=>{r()}),ie(()=>{setTimeout(()=>{r()},0),window.addEventListener("resize",y)}),ke(()=>{window.removeEventListener("resize",y)});const y=()=>{r(!1)},r=(h=!0)=>{var ve,_e,we,ye;const{centerPoint:g,radius:u,circlePadding:S,listLength:I}=t,P=document.querySelector(`.${s.value}`),V=document.querySelector(`.${s.value} .${L}-cardWrap`),re=(ve=P==null?void 0:P.clientWidth)!=null?ve:0,ce=(_e=P==null?void 0:P.clientHeight)!=null?_e:0;n.isVertical=ce>re;const Me=(we=V==null?void 0:V[n.isVertical?"clientHeight":"clientWidth"])!=null?we:0,me=(ye=V==null?void 0:V[n.isVertical?"clientWidth":"clientHeight"])!=null?ye:0;l.circleR=Math.round(g==="center"?u!=null?u:Math.min(ce,re)/2-S-me/2:u!=null?u:Math.max(ce,re));const pe=2*180*Math.atan(Me/2/(l.circleR-me/2))/Math.PI+t.cardAddDeg;if(t.isAverage&&I){const Ee=Math.floor(360/pe),xe=Math.min(Ee,I);m.pageSize=xe,l.cardDeg=360/xe}else l.cardDeg=pe;n.circleR=l.circleR,n.cardDeg=l.cardDeg,o("onPageChange",{...m}),h&&H({index:t.initCartNum})},w=h=>{const g=document.querySelector(`.${s.value} .${L}-area`);c.w=g.clientWidth,c.h=g.clientHeight;const u=g.getBoundingClientRect();c.left=u.left,c.top=u.top,i.x=u.left+u.width/2,i.y=u.top+u.height/2,x.startDeg=$e({x:h.clientX,y:h.clientY},{x:i.x,y:i.y})},p=h=>{h.stopPropagation();const g=Z(h);Q()||(document.addEventListener("mousemove",b,!0),document.addEventListener("mouseup",E,!0)),w({clientX:g.clientX,clientY:g.clientY}),x.time=Date.now(),_.value=10,x.preDeg=d.value,o("onTouchStart")},b=h=>{h.stopPropagation();const g=Z(h);let u=$e({x:g.clientX,y:g.clientY},{x:i.x,y:i.y})-x.startDeg;if(Math.abs(u-x.preRoundDeg)>250){const S=u>0?-360:360;u+=S,x.startDeg-=S}x.preRoundDeg=u,u+=x.preDeg,d.value=u,o("onTouchMove")},E=h=>{h.stopPropagation(),Q()||(document.removeEventListener("mousemove",b,!0),document.removeEventListener("mouseup",E,!0));let g=600,u=d.value;const S=u-x.preDeg,I=Date.now()-x.time;if(Math.abs(S)>10&&I<250){const V=I/250;g=1e3,u=x.preDeg+Math.round(S/V)}const P=Ue({changeDeg:S,deg:u,cardDeg:l.cardDeg});n.isClick=Math.abs(S)<1&&I<120,_.value=g,d.value=P,o("onTouchEnd"),z(P,g)},B=K(()=>m.pageNum<=1),T=K(()=>m.pageNum*m.pageSize>=t.listLength),N=h=>{if(h){if(T.value)return}else if(B.value)return;m.pageNum+=h?1:-1,d.value=0,o("onPageChange",{...m})},H=({deg:h,index:g,duration:u})=>{if(typeof g=="number"||typeof h=="number"){const S=typeof g=="number"?l.cardDeg*g:h,I=Ce(t.centerPoint,n.isVertical,t.isFlipDirection);d.value=S*I,typeof u=="number"&&(_.value=u),z(S*I,u!=null?u:_.value)}},z=(h,g)=>{t.onScrollEnd&&setTimeout(()=>{const u=Ce(t.centerPoint,n.isVertical,t.isFlipDirection);let S=Math.floor(h/l.cardDeg)%t.listLength*u;S<0&&(S+=t.listLength),o("onScrollEnd",S,h)},g!=null?g:_.value)};return(h,g)=>(D(),M("div",{class:R(`${a(L)} ${s.value}`),style:ee({width:t.width,height:t.height}),onMousedown:p,onTouchstart:p,onTouchmove:b,onTouchend:E,onTouchcancel:E},[v("div",{class:R(`${a(L)}-area`),style:ee(f.value)},[ne(h.$slots,"default",{},void 0,!0)],6),t.isPagination?(D(),M(ue,{key:0},[v("div",{class:R(`${a(se)(`${a(L)}-arrow`,{left:!0,disable:B.value})}`),onClick:g[0]||(g[0]=u=>N())},[h.$slots["left-arrow"]?J("",!0):(D(),M("div",{key:0,class:R(`${a(se)(`${a(L)}-arrow-area`,{left:!0})}`)},F("<"),2)),ne(h.$slots,"left-arrow",{},void 0,!0)],2),v("div",{class:R(`${a(se)(`${a(L)}-arrow`,{right:!0,disable:T.value})}`),onClick:g[1]||(g[1]=u=>N(!0))},[h.$slots["right-arrow"]?J("",!0):(D(),M("div",{key:0,class:R(`${a(se)(`${a(L)}-arrow-area`,{right:!0})}`)},F(">"),2)),ne(h.$slots,"right-arrow",{},void 0,!0)],2)],64)):J("",!0)],38))}});const Ke=te(Ge,[["__scopeId","data-v-0c2e37b2"]]),Je=U({__name:"item",props:{index:{}},emits:["onClick"],setup(e,{emit:o}){const t=e,s=Be(Te),n=K(()=>{const{circleR:c,cardDeg:i,isVertical:l,centerPoint:x,isFlipDirection:d}=s,{initDeg:m,nx:_,ny:f,isAddDeg:y}=je({centerPoint:x,isFlipDirection:d,isVertical:l}),r=m+i*t.index,w=c*(1-f*Math.cos(r*Math.PI/180)),p=c*(1-_*Math.sin(r*Math.PI/180)),b=m-_*f*r+(y?180:0);return{top:`${w}px`,left:`${p}px`,transform:`translate(-50%, -50%) rotate(${b}deg)`}});return(c,i)=>(D(),M("div",{class:R(`${a(L)}-cardWrap`),style:ee(n.value),onClick:i[0]||(i[0]=()=>{var l;(l=a(s))!=null&&l.isClick&&o("onClick",t.index)})},[ne(c.$slots,"default",{},void 0,!0)],6))}});const Qe=te(Je,[["__scopeId","data-v-33dd9a62"]]);const Pt={type:Boolean,default:!0},Rt=e=>({type:Number,default:e}),Ze=e=>({type:String,default:e}),oe="legendTD-floating-ball",et={axis:Ze("xy"),magnetic:String,style:Object},Ft=U({props:et,emits:["onMagnetic","onOffsetChange"],setup(e,o){const{emit:t,slots:s}=o,n=X(ge(oe)),c=$({w:0,h:0,r:0,l:0,t:0,b:0}),i=$({startX:0,startY:0}),l=$({x:0,y:0}),x=X(null),d=X(.1),m=r=>{r.stopPropagation();const w=Z(r);i.startX=w.clientX-l.x,i.startY=w.clientY-l.y,Q()||(document.addEventListener("mousemove",_,!0),document.addEventListener("mouseup",f,!0)),d.value=.1},_=r=>{r.stopPropagation();const w=Z(r),p=e.axis==="y"?0:w.clientX-i.startX,b=e.axis==="x"?0:w.clientY-i.startY;l.x=p,l.y=b,t("onOffsetChange",{x:p,y:b})},f=r=>{r.stopPropagation(),Q()||(document.removeEventListener("mousemove",_,!0),document.removeEventListener("mouseup",f,!0));const w=Z(r);let p=e.axis==="y"?0:w.clientX-i.startX,b=e.axis==="x"?0:w.clientY-i.startY;const{w:E,h:B,l:T,r:N,t:H,b:z}=c;if(e.magnetic==="x"){const A=T<N?T:N,W=T<N?-1:1,q=window.innerWidth/2-A-E/2,Y=-1*W*(window.innerWidth-E-A*2);p=Math.abs(p)>q&&p*W<0?Y:0,t("onMagnetic",p===0?T<N:T>N)}else if(e.magnetic==="y"){const A=H<z?H:z,W=H<z?-1:1,q=window.innerHeight/2-A-B/2,Y=-1*W*(window.innerHeight-B-A*2);b=Math.abs(b)>q&&b*W<0?Y:0,t("onMagnetic",b===0?H<z:H>z)}d.value=.3,l.x=p,l.y=b};ie(()=>{const r=()=>{const w=document.querySelector(`.${n.value} .${oe}-button`);if(!w)return;const p=w.getBoundingClientRect();c.w=p.width,c.h=p.height,c.l=p.left,c.r=window.innerWidth-p.right,c.t=p.top,c.b=window.innerHeight-p.bottom};setTimeout(()=>{r()},10)});const y=()=>Q()?{onTouchstart:m,onTouchmove:_,onTouchend:f,onTouchcancel:f}:{onMousedown:m,onMouseup:f};return()=>C("div",be({class:`${oe} ${n.value}`},e),[C("div",be({ref:x,class:`${oe}-button`,style:{transitionDuration:d.value+"s",transform:`translate(${l.x}px, ${l.y}px)`}},y()),[(s==null?void 0:s.default)&&s.default()])])}}),tt=async()=>{try{const{data:e,error:o}=await de.from("leaderboards").select(`
        *,
        users(username, avatar_url, display_name)
      `).order("score",{ascending:!1}).limit(100);if(o)throw o;return{code:200,data:(e==null?void 0:e.map(s=>{var n,c,i;return{id:s.user_id,avatar:((n=s.users)==null?void 0:n.avatar_url)||"",name:((c=s.users)==null?void 0:c.display_name)||((i=s.users)==null?void 0:i.username)||"Unknown",max:{score:s.score,level:parseInt(s.level_id)||1},101:s.score}}))||[]}}catch(e){return console.error("\u83B7\u53D6\u6392\u884C\u699C\u9519\u8BEF:",e),{code:-1,data:[]}}},Nt=async e=>{try{const{data:o,error:t}=await de.from("leaderboards").select("score").eq("user_id",e.userId).eq("level_id",e.level.toString()).single();let s=!0;if(!t&&o&&o.score>=e.score&&(s=!1),s){const{error:n}=await de.from("leaderboards").upsert({user_id:e.userId,level_id:e.level.toString(),score:e.score,submission_date:new Date().toISOString(),rank_position:0},{onConflict:"user_id,level_id"});if(n)throw n}return{isUpdate:s,score:e.score}}catch(o){return console.error("\u66F4\u65B0\u5206\u6570\u9519\u8BEF:",o),{isUpdate:!1,score:e.score}}},st=U({__name:"rankList",props:{visible:{type:Boolean,default:!1,require:!0}},emits:["update:visible"],setup(e,{emit:o}){const t=fe(),s=$({rankList:[],total:0}),n=async()=>{try{const c=await tt();s.rankList=c.data||[]}catch(c){console.log("error: ",c)}};return(c,i)=>(D(),ae(a(Fe),{modelValue:e.visible,title:"\u6392\u884C\u699C",width:a(t).isMobile?"100%":"60%",onOpen:n,onClose:i[0]||(i[0]=l=>o("update:visible",!1))},{default:k(()=>[C(a(Re),{data:s.rankList,class:"rankListTable",stripe:"",style:{width:"100%"}},{default:k(()=>[C(a(j),{type:"index"}),C(a(j),{prop:"avatar",label:"\u5934\u50CF"},{default:k(l=>[C(a(Ie),{src:l.row.avatar,size:30},null,8,["src"])]),_:1}),C(a(j),{prop:"name",label:"\u7528\u6237\u540D"}),C(a(j),{prop:"max",label:"\u62B5\u5FA1\u6CE2\u6570"},{default:k(l=>[Se(F(l.row.max.score),1)]),_:1}),C(a(j),{prop:"max",label:"\u6240\u5728\u5173\u5361"},{default:k(l=>[C(a(Pe),null,{default:k(()=>[Se(F(l.row.max.level+1),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue","width"]))}});const zt=te(st,[["__scopeId","data-v-fea05d30"]]);function ot(){return new Worker("/assets/index.6e419f68.js")}const nt={},he=e=>(Ne("data-v-3f91e1e9"),e=e(),ze(),e),at={class:"loading-wrap"},it=he(()=>v("div",{class:"loading-item"},null,-1)),rt=he(()=>v("div",{class:"loading-item"},null,-1)),ct=he(()=>v("div",{class:"loading-item"},null,-1)),lt=[it,rt,ct];function ut(e,o){return D(),M("div",at,lt)}const dt=te(nt,[["render",ut],["__scopeId","data-v-3f91e1e9"]]),ft=["width","height"],gt=U({__name:"towerCanvas",props:{tname:{},towerList:{},enemyList:{default:()=>[{enemyName:"zombie-1"}]},isPause:{type:Boolean,default:!1}},setup(e){const o=e,t=fe(),s=Ae(),n=X(ge("com-cover-canvas")),c=X(),i=$({canvasInfo:{w:0,h:0},size:10,isReady:!1});le(()=>o.isPause,d=>{var m;(m=c.value)==null||m.postMessage({isPause:d})}),ie(()=>{setTimeout(()=>{l()},10)}),We(()=>{var d;(d=c.value)==null||d.terminate()});function l(){var f,y;const d=document.querySelector(`.${n.value}`),m=((f=d==null?void 0:d.clientWidth)!=null?f:0)*t.ratio,_=((y=d==null?void 0:d.clientHeight)!=null?y:0)*t.ratio;i.canvasInfo.w=m,i.canvasInfo.h=_,i.size=_/7,setTimeout(()=>{x()},10)}function x(){const d=document.querySelector(`.${n.value} canvas`);if(!d)return;const m=d.transferControlToOffscreen(),_=new ot;c.value=_,_.postMessage({init:!0,isTowerCover:!0,enemyList:o.enemyList,towerList:o.tname?[{x:4,y:3,towerName:o.tname}]:o.towerList,source:{isMobile:t.isMobile,ratio:t.ratio,mapLevel:t.mapLevel},setting:{isHighRefreshScreen:s.isHighRefreshScreen},canvasInfo:{offscreen:m,size:i.size}},[m]),_.onmessage=f=>{const{data:y}=f;y.fnName==="onWorkerReady"&&(i.isReady=!0)}}return(d,m)=>(D(),M("div",{class:R(["com-tower-canvas",n.value])},[v("canvas",{width:i.canvasInfo.w,height:i.canvasInfo.h,style:ee({width:i.canvasInfo.w/a(t).ratio+"px",height:i.canvasInfo.h/a(t).ratio+"px"})},null,12,ft),i.isReady?J("",!0):(D(),ae(dt,{key:0,class:"loading"}))],2))}});const ht=te(gt,[["__scopeId","data-v-9355dd27"]]),mt={class:"selectTowerPop-header"},pt={class:"selectTowerPop-header-content"},vt=v("div",{class:"mask mask-left"},null,-1),_t=["src"],wt={class:"towerName"},yt=["onClick"],xt=v("div",{class:"mask mask-right"},null,-1),bt={class:"selectNum"},St={class:"selectTowerPop-content"},Dt={class:"card"},Ct={class:"towerImg"},$t={class:"nameWrap"},Tt={class:"name"},Mt={class:"money"},Et={class:"explain"},Lt={key:0,class:"card-select"},At=U({__name:"selectTowerPop",props:{visible:{type:Boolean,default:!1,require:!0}},emits:["update:visible","reStart"],setup(e,{emit:o}){const t=Ve(),s=fe(),n=$({items:[],pageNum:1,pageSize:Object.keys(O).length}),c=K(()=>Object.values(O)),i=({pageNum:f,pageSize:y})=>{const r=(f-1)*y,w=c.value.slice(r,r+y);n.items=w,n.pageNum=f,n.pageSize=y},l=f=>t.towerSelectList.find(y=>y===f)!==void 0,x=f=>{s.isGameing?Oe.confirm("\u91CD\u65B0\u9009\u62E9\u5854\u9632\u540E\uFF0C\u6E38\u620F\u5C06\u91CD\u65B0\u5F00\u59CB\uFF0C\u4F60\u786E\u5B9A\u8981\u91CD\u9009\u5854\u9632\u5417\uFF1F","Warning",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{d(f),o("reStart")}):d(f)},d=f=>{const y=t.towerSelectList.findIndex(r=>r===f);y!==-1?t.towerSelectList.splice(y,1):t.towerSelectList.length<8?t.towerSelectList.push(f):qe.info("\u6700\u591A\u53EA\u80FD\u90098\u4E2A\u82F1\u96C4~")},m=()=>{o("update:visible",!1)},_=()=>{const f=(n.pageNum-1)*n.pageSize;n.items=c.value.slice(f,f+n.pageSize)};return ie(()=>{_()}),(f,y)=>(D(),ae(a(He),{"model-value":e.visible,class:R(["selectTowerPop",{selectTowerPopMobile:a(s).isMobile}]),"with-header":!1,size:a(s).isMobile?"80vh":"90vh",direction:"btt",onClose:m,style:ee({"--selectCardSize":a(s).isMobile?"10vh":"12vw","--cardGridSize":a(s).isMobile?"6vw":"16px"})},{default:k(()=>[v("div",mt,[v("div",pt,[vt,(D(!0),M(ue,null,De(a(t).towerSelectList,r=>{var w,p,b,E;return D(),M("div",{key:(w=a(O)[r])==null?void 0:w.name,class:"towerBox"},[v("img",{src:(p=a(O)[r])==null?void 0:p.img,alt:"",class:"towerImg"},null,8,_t),C(a(Xe),{content:(E=a(G)[(b=a(O)[r])==null?void 0:b.name])==null?void 0:E.explain},{default:k(()=>{var B,T;return[v("div",wt,F((T=a(G)[(B=a(O)[r])==null?void 0:B.name])==null?void 0:T.name),1)]}),_:2},1032,["content"]),v("span",{class:"closeIcon iconfont icon-close",onClick:B=>x(r)},null,8,yt)])}),128)),xt]),v("div",bt,F(a(t).towerSelectList.length)+" / 8",1)]),v("div",St,[C(Ke,{"list-length":c.value.length,"card-add-deg":3,"center-point":a(s).isMobile?"right":"center",onOnPageChange:i},{default:k(()=>[(D(!0),M(ue,null,De(n.items,(r,w)=>(D(),ae(Qe,{key:r.name,index:w,onOnClick:()=>{x(r.name)}},{default:k(()=>[v("div",Dt,[v("div",Ct,[C(ht,{tname:r.name,"enemy-list":a(G)[r.name].enemyList,"is-pause":!e.visible},null,8,["tname","enemy-list","is-pause"])]),v("div",$t,[v("span",Tt,"\xB7 "+F(a(G)[r.name].name),1),v("span",Mt,"\u91D1\u989D: "+F(a(O)[r.name].money),1)]),v("div",Et,F(a(G)[r.name].explain),1),l(r.name)?(D(),M("div",Lt,"\u5DF2\u9009")):J("",!0)])]),_:2},1032,["index","onOnClick"]))),128))]),_:1},8,["list-length","center-point"])]),v("span",{class:"close",onClick:m},"\xD7")]),_:1},8,["model-value","class","size","style"]))}});const Wt="/assets/myGame.23e769d1.png";export{Ft as F,dt as L,zt as R,Ke as S,ht as T,ot as W,At as _,Qe as a,Ze as b,Wt as c,Rt as m,ge as r,Pt as t,Nt as u};
