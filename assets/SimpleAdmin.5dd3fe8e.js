import{r as d,z as H,m as J,o as i,e as r,f as e,v as o,F as C,q as U,l as p,X as h,ac as y,h as $,ae as K,n as g,p as P,j as Q}from"./index.bc555423.js";import{s as c}from"./supabase.89508a55.js";import{_ as W}from"./_plugin-vue_export-helper.cdc0426e.js";const a=w=>(P("data-v-0816cff6"),w=w(),Q(),w),Y={class:"simple-admin"},Z={class:"admin-header"},ee=a(()=>e("h1",null,"\u{1F3F0} \u5854\u9632\u8054\u76DF\u7BA1\u7406",-1)),te={class:"user-info"},se={class:"admin-tabs"},le=["onClick"],oe={class:"admin-content"},ae={key:0,class:"tab-content"},ne=a(()=>e("h2",null,"\u{1F4CA} \u6570\u636E\u6982\u89C8",-1)),ie={class:"stats-grid"},re={class:"stat-card"},ce={class:"stat-number"},de=a(()=>e("div",{class:"stat-label"},"\u603B\u7528\u6237",-1)),ue={class:"stat-card"},_e={class:"stat-number"},ve=a(()=>e("div",{class:"stat-label"},"\u5728\u7EBF\u7528\u6237",-1)),me={class:"stat-card"},he={class:"stat-number"},fe=a(()=>e("div",{class:"stat-label"},"\u4ECA\u65E5\u6E38\u620F",-1)),be={class:"stat-card"},pe={class:"stat-number"},ye=a(()=>e("div",{class:"stat-label"},"\u5173\u5361\u603B\u6570",-1)),ge={key:1,class:"tab-content"},we={class:"section-header"},ke=a(()=>e("h2",null,"\u{1F465} \u7528\u6237\u7BA1\u7406",-1)),Ce={class:"table-container"},Ue={class:"admin-table"},Se=a(()=>e("thead",null,[e("tr",null,[e("th",null,"\u7528\u6237\u540D"),e("th",null,"\u90AE\u7BB1"),e("th",null,"\u91D1\u5E01"),e("th",null,"\u94BB\u77F3"),e("th",null,"\u72B6\u6001"),e("th",null,"\u64CD\u4F5C")])],-1)),xe=["onClick"],Le={key:2,class:"tab-content"},De={class:"section-header"},Ve=a(()=>e("h2",null,"\u{1F5FA}\uFE0F \u5173\u5361\u7BA1\u7406",-1)),$e={class:"levels-grid"},Ie={class:"level-header"},qe={class:"level-info"},Ae={class:"level-actions"},Ge=["onClick"],Me=["onClick"],Te={key:3,class:"tab-content"},ze=a(()=>e("h2",null,"\u{1F3AE} \u6E38\u620F\u8BB0\u5F55",-1)),Be={class:"table-container"},Ne={class:"admin-table"},Oe=a(()=>e("thead",null,[e("tr",null,[e("th",null,"\u7528\u6237\u540D"),e("th",null,"\u5173\u5361"),e("th",null,"\u5206\u6570"),e("th",null,"\u661F\u661F"),e("th",null,"\u65F6\u95F4"),e("th",null,"\u7ED3\u679C")])],-1)),Ee=["onSubmit"],Fe={class:"form-group"},Re=a(()=>e("label",null,"\u5173\u5361\u540D\u79F0",-1)),je={class:"form-group"},Xe=a(()=>e("label",null,"\u5173\u5361\u5E8F\u53F7",-1)),He={class:"form-group"},Je=a(()=>e("label",null,"\u96BE\u5EA6",-1)),Ke=a(()=>e("option",{value:"easy"},"\u7B80\u5355",-1)),Pe=a(()=>e("option",{value:"medium"},"\u4E2D\u7B49",-1)),Qe=a(()=>e("option",{value:"hard"},"\u56F0\u96BE",-1)),We=[Ke,Pe,Qe],Ye={class:"form-group"},Ze=a(()=>e("label",null,"\u521D\u59CB\u91D1\u5E01",-1)),et={class:"form-group"},tt=a(()=>e("label",null,"\u6700\u5927\u6CE2\u6570",-1)),st={class:"modal-actions"},lt=a(()=>e("button",{type:"submit",class:"save-btn"},"\u4FDD\u5B58",-1)),ot={__name:"SimpleAdmin",setup(w){const L=d(null),v=d("dashboard"),f=d(""),m=d(!1),k=d(!1),I=[{key:"dashboard",label:"\u{1F4CA} \u6570\u636E\u6982\u89C8"},{key:"users",label:"\u{1F465} \u7528\u6237\u7BA1\u7406"},{key:"levels",label:"\u{1F5FA}\uFE0F \u5173\u5361\u7BA1\u7406"},{key:"records",label:"\u{1F3AE} \u6E38\u620F\u8BB0\u5F55"}],b=d({totalUsers:0,onlineUsers:0,todayGames:0,totalLevels:0}),S=d([]),D=d([]),V=d([]),n=d({level_name:"",level_number:1,difficulty:"medium",initial_coins:500,max_waves:10,level_id:null}),q=H(()=>f.value?S.value.filter(s=>s.username.toLowerCase().includes(f.value.toLowerCase())||s.email.toLowerCase().includes(f.value.toLowerCase())):S.value),A=async()=>{try{const{count:s}=await c.from("users").select("*",{count:"exact",head:!0}),l=new Date(Date.now()-5*60*1e3).toISOString(),{count:_}=await c.from("users").select("*",{count:"exact",head:!0}).gte("last_login",l),t=new Date().toISOString().split("T")[0],{count:u}=await c.from("game_sessions").select("*",{count:"exact",head:!0}).gte("created_at",t),{count:X}=await c.from("game_levels").select("*",{count:"exact",head:!0});b.value={totalUsers:s||0,onlineUsers:_||0,todayGames:u||0,totalLevels:X||0}}catch(s){console.error("\u52A0\u8F7D\u7EDF\u8BA1\u6570\u636E\u5931\u8D25:",s)}},G=async()=>{try{const{data:s,error:l}=await c.from("users").select("user_id, username, email, coins, gems, status").order("registration_date",{ascending:!1}).limit(50);if(l)throw l;S.value=s||[]}catch(s){console.error("\u52A0\u8F7D\u7528\u6237\u5217\u8868\u5931\u8D25:",s)}},x=async()=>{try{const{data:s,error:l}=await c.from("game_levels").select("*").order("level_number");if(l)throw l;D.value=s||[]}catch(s){console.error("\u52A0\u8F7D\u5173\u5361\u5217\u8868\u5931\u8D25:",s)}},M=async()=>{try{const{data:s,error:l}=await c.from("game_sessions").select(`
        session_id,
        score,
        stars_earned,
        is_victory,
        created_at,
        user_id,
        users(username),
        level_id,
        game_levels(level_name)
      `).order("created_at",{ascending:!1}).limit(20);if(l)throw l;V.value=s||[]}catch(s){console.error("\u52A0\u8F7D\u6E38\u620F\u8BB0\u5F55\u5931\u8D25:",s)}},T=async s=>{try{const l=s.status==="active"?"banned":"active",{error:_}=await c.from("users").update({status:l}).eq("user_id",s.user_id);if(_)throw _;s.status=l}catch(l){console.error("\u66F4\u65B0\u7528\u6237\u72B6\u6001\u5931\u8D25:",l),alert("\u64CD\u4F5C\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}},z=s=>{k.value=!0,n.value={...s},m.value=!0},B=async()=>{try{if(k.value){const{error:s}=await c.from("game_levels").update(n.value).eq("level_id",n.value.level_id);if(s)throw s}else{const{error:s}=await c.from("game_levels").insert([n.value]);if(s)throw s}m.value=!1,k.value=!1,n.value={level_name:"",level_number:1,difficulty:"medium",initial_coins:500,max_waves:10,level_id:null},x()}catch(s){console.error("\u4FDD\u5B58\u5173\u5361\u5931\u8D25:",s),alert("\u4FDD\u5B58\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}},N=async s=>{if(!!confirm(`\u786E\u5B9A\u8981\u5220\u9664\u5173\u5361 "${s.level_name}" \u5417\uFF1F`))try{const{error:l}=await c.from("game_levels").delete().eq("level_id",s.level_id);if(l)throw l;x()}catch(l){console.error("\u5220\u9664\u5173\u5361\u5931\u8D25:",l),alert("\u5220\u9664\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}},O=()=>{},E=s=>({easy:"\u7B80\u5355",medium:"\u4E2D\u7B49",hard:"\u56F0\u96BE",expert:"\u4E13\u5BB6"})[s]||s,F=s=>s?new Date(s).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",R=async()=>{await c.auth.signOut(),window.location.href="/"},j=async()=>{try{const{data:{user:s}}=await c.auth.getUser();s?(L.value=s,A(),G(),x(),M()):window.location.href="/login"}catch(s){console.error("\u68C0\u67E5\u767B\u5F55\u72B6\u6001\u5931\u8D25:",s),window.location.href="/login"}};return J(()=>{j()}),(s,l)=>{var _;return i(),r("div",Y,[e("div",Z,[ee,e("div",te,[e("span",null,"\u6B22\u8FCE\uFF0C"+o(((_=L.value)==null?void 0:_.username)||"\u7BA1\u7406\u5458"),1),e("button",{onClick:R,class:"logout-btn"},"\u9000\u51FA")])]),e("div",se,[(i(),r(C,null,U(I,t=>e("button",{key:t.key,onClick:u=>v.value=t.key,class:g(["tab-btn",{active:v.value===t.key}])},o(t.label),11,le)),64))]),e("div",oe,[v.value==="dashboard"?(i(),r("div",ae,[ne,e("div",ie,[e("div",re,[e("div",ce,o(b.value.totalUsers),1),de]),e("div",ue,[e("div",_e,o(b.value.onlineUsers),1),ve]),e("div",me,[e("div",he,o(b.value.todayGames),1),fe]),e("div",be,[e("div",pe,o(b.value.totalLevels),1),ye])])])):p("",!0),v.value==="users"?(i(),r("div",ge,[e("div",we,[ke,h(e("input",{"onUpdate:modelValue":l[0]||(l[0]=t=>f.value=t),placeholder:"\u641C\u7D22\u7528\u6237...",class:"search-input",onInput:O},null,544),[[y,f.value]])]),e("div",Ce,[e("table",Ue,[Se,e("tbody",null,[(i(!0),r(C,null,U(q.value,t=>(i(),r("tr",{key:t.user_id},[e("td",null,o(t.username),1),e("td",null,o(t.email),1),e("td",null,o(t.coins),1),e("td",null,o(t.gems),1),e("td",null,[e("span",{class:g(["status",t.status])},o(t.status==="active"?"\u6B63\u5E38":"\u5C01\u7981"),3)]),e("td",null,[e("button",{onClick:u=>T(t),class:g(["action-btn",t.status==="active"?"ban":"unban"])},o(t.status==="active"?"\u5C01\u7981":"\u89E3\u5C01"),11,xe)])]))),128))])])])])):p("",!0),v.value==="levels"?(i(),r("div",Le,[e("div",De,[Ve,e("button",{onClick:l[1]||(l[1]=t=>m.value=!0),class:"add-btn"},"\u6DFB\u52A0\u5173\u5361")]),e("div",$e,[(i(!0),r(C,null,U(D.value,t=>(i(),r("div",{key:t.level_id,class:"level-card"},[e("div",Ie,[e("h3",null,o(t.level_name),1),e("span",{class:g(["difficulty",t.difficulty])},o(E(t.difficulty)),3)]),e("div",qe,[e("p",null,"\u5173\u5361: "+o(t.level_number),1),e("p",null,"\u521D\u59CB\u91D1\u5E01: "+o(t.initial_coins),1),e("p",null,"\u6CE2\u6570: "+o(t.max_waves),1)]),e("div",Ae,[e("button",{onClick:u=>z(t),class:"edit-btn"},"\u7F16\u8F91",8,Ge),e("button",{onClick:u=>N(t),class:"delete-btn"},"\u5220\u9664",8,Me)])]))),128))])])):p("",!0),v.value==="records"?(i(),r("div",Te,[ze,e("div",Be,[e("table",Ne,[Oe,e("tbody",null,[(i(!0),r(C,null,U(V.value,t=>{var u;return i(),r("tr",{key:t.session_id},[e("td",null,o(t.username),1),e("td",null,o(t.level_name),1),e("td",null,o(((u=t.score)==null?void 0:u.toLocaleString())||0),1),e("td",null,o(t.stars_earned||0),1),e("td",null,o(F(t.created_at)),1),e("td",null,[e("span",{class:g(["result",t.is_victory?"win":"lose"])},o(t.is_victory?"\u80DC\u5229":"\u5931\u8D25"),3)])])}),128))])])])])):p("",!0)]),m.value?(i(),r("div",{key:0,class:"modal-overlay",onClick:l[9]||(l[9]=t=>m.value=!1)},[e("div",{class:"modal",onClick:l[8]||(l[8]=$(()=>{},["stop"]))},[e("h3",null,o(k.value?"\u7F16\u8F91\u5173\u5361":"\u6DFB\u52A0\u5173\u5361"),1),e("form",{onSubmit:$(B,["prevent"])},[e("div",Fe,[Re,h(e("input",{"onUpdate:modelValue":l[2]||(l[2]=t=>n.value.level_name=t),required:""},null,512),[[y,n.value.level_name]])]),e("div",je,[Xe,h(e("input",{"onUpdate:modelValue":l[3]||(l[3]=t=>n.value.level_number=t),type:"number",required:""},null,512),[[y,n.value.level_number,void 0,{number:!0}]])]),e("div",He,[Je,h(e("select",{"onUpdate:modelValue":l[4]||(l[4]=t=>n.value.difficulty=t)},We,512),[[K,n.value.difficulty]])]),e("div",Ye,[Ze,h(e("input",{"onUpdate:modelValue":l[5]||(l[5]=t=>n.value.initial_coins=t),type:"number"},null,512),[[y,n.value.initial_coins,void 0,{number:!0}]])]),e("div",et,[tt,h(e("input",{"onUpdate:modelValue":l[6]||(l[6]=t=>n.value.max_waves=t),type:"number"},null,512),[[y,n.value.max_waves,void 0,{number:!0}]])]),e("div",st,[e("button",{type:"button",onClick:l[7]||(l[7]=t=>m.value=!1)},"\u53D6\u6D88"),lt])],40,Ee)])])):p("",!0)])}}},rt=W(ot,[["__scopeId","data-v-0816cff6"]]);export{rt as default};
