# 塔防联盟 - 功能文档

## 项目概述

塔防联盟是一款基于Vue3和TypeScript开发的网页塔防游戏，支持PC端和移动端。游戏采用Canvas渲染和Web Worker技术实现高性能游戏体验，具有丰富的游戏元素和精美的视觉效果。

### 技术栈
- **前端框架**：Vue 3.3.4 + TypeScript 5.1.6
- **构建工具**：Vite 3.2.0
- **UI框架**：Element Plus 2.8.2
- **状态管理**：Pinia 2.0.28
- **游戏渲染**：Canvas API + Web Worker
- **数据库**：Supabase (PostgreSQL)
- **后台管理**：基于 Element Plus 的管理系统
- **样式预处理**：Less 3.13.1

---

## 核心功能

### 1. 游戏系统
#### 1.1 关卡系统
- **普通关卡**：包含10+个精心设计的关卡，难度逐步递增
- **试玩模式**：提供初始资金和体验环境
- **无尽模式**：挑战玩家极限，看能坚持多少波敌人

#### 1.2 地图系统
- **多样化地图**：包括X形、圣诞树、H形、V形、T形等多种地图布局
- **智能路径**：敌人按照预设路径前进，玩家需要策略性布置防御塔
- **动态渲染**：使用Canvas实现高性能地图渲染

#### 1.3 资源系统
- **金币系统**：通过消灭敌人获得金币，用于建造和升级防御塔
- **生命值系统**：当敌人到达终点时扣除生命值，生命值归零游戏结束

### 2. 防御塔系统

#### 2.1 塔防种类（12种特色防御塔）
- **冰之星辉**：减速敌人，控制型防御塔
- **破阵枪骑**：多目标攻击，范围伤害
- **炼狱之爪**：快速连发，单体高伤害
- **幽影射手**：远程高伤害，大攻击范围
- **奥术弹幕**：穿透攻击，可攻击多个敌人
- **烈焰熔炉**：群体伤害，范围攻击
- **寒冰射手**：减速与多重箭矢
- **回旋战斧**：旋转飞斧，可攻击多个目标
- **烈焰法师**：持续火焰伤害
- **暗影毒师**：中毒效果，持续伤害
- **更多塔防**：每种塔都有独特技能和定位

#### 2.2 塔防机制
- **建造系统**：在指定位置建造防御塔
- **升级系统**：部分防御塔支持升级，提升攻击力和攻击范围
- **售卖系统**：可以回收已建造的防御塔，返还部分金币

### 3. 敌人系统

#### 3.1 敌人种类（10+种不同特性敌人）
- **普通僵尸**：基础敌人，低生命值和速度
- **铁门僵尸**：高防御，移动缓慢
- **橄榄球僵尸**：高速移动，高生命值
- **报纸僵尸**：低生命值但高奖励
- **舞蹈僵尸**：特殊行动模式，可召唤小僵尸
- **撑杆跳僵尸**：可以越过障碍
- **冰车僵尸**：冰冻效果的敌人
- **阿福**：高生命值的boss敌人
- **弗利萨**：强力boss，可召唤小僵尸
- **哥斯拉**：终极boss，具有强大技能

#### 3.2 敌人机制
- **等级系统**：敌人具有不同等级，等级越高生命值和奖励越多
- **技能系统**：特殊敌人拥有独特技能
- **路径系统**：敌人按照地图预设路径前进

### 4. 技能系统

#### 4.1 全局技能
- **炸弹技能**：清除屏幕内所有敌人
- **肉弹冲击**：沿直线造成范围伤害
- **更多技能**：提供战术选择和应对策略

#### 4.2 技能机制
- **冷却系统**：每个技能使用后需要等待冷却时间
- **金币消耗**：使用技能需要消耗一定金币
- **战术应用**：在关键时刻使用技能扭转战局

### 5. 用户系统

#### 5.1 账户功能
- **用户注册**：支持新用户创建账户
- **用户登录**：已有用户登录系统
- **游客模式**：未登录用户也可以体验游戏

#### 5.2 数据同步
- **进度保存**：登录用户的游戏进度自动保存
- **成绩记录**：记录玩家的最高分数和关卡进度
- **排行榜**：展示全球或本地玩家排名

#### 5.3 数据库支持
- **Supabase集成**：使用PostgreSQL数据库存储用户数据和游戏记录
- **用户管理**：完整的用户注册、登录、信息管理功能
- **分数存储**：实时记录和更新游戏分数
- **安全策略**：行级安全策略(RLS)确保数据安全

### 5.4 后台管理系统
- **实时数据监控**：查看用户总数、游戏记录、活跃用户等关键指标
- **用户管理功能**：查看用户详情、删除用户及其游戏记录
- **游戏记录管理**：查看所有游戏记录、按关卡筛选、删除单条记录
- **数据导出功能**：CSV格式导出完整用户数据
- **安全认证机制**：简单的密码验证保护系统安全
- **响应式设计**：支持桌面端和移动端访问

### 6. 游戏界面与交互

#### 6.1 主界面
- **关卡选择**：可视化展示所有关卡，支持滑动浏览
- **用户中心**：显示用户信息、金币、历史战绩等
- **设置选项**：音乐开关、音效控制等
- **管理入口**：右下角设置按钮可进入后台管理系统

#### 6.2 游戏界面
- **游戏画布**：使用Canvas渲染游戏主场景
- **导航栏**：显示当前关卡、金币、暂停/开始等控制按钮
- **技能栏**：放置可用的全局技能
- **防御塔选择栏**：显示已选择的防御塔，支持快速建造

#### 6.3 交互设计
- **响应式布局**：完美适配PC端和移动端
- **触摸支持**：移动端支持触摸操作
- **键盘快捷键**：PC端支持快捷键操作

---

## 特色功能

### 1. 高性能渲染
- **Canvas渲染**：使用Canvas 2D API实现高效渲染
- **Web Worker**：游戏逻辑在Web Worker中运行，不阻塞主线程
- **优化算法**：高效的碰撞检测和路径计算

### 2. 视觉效果
- **流畅动画**：所有游戏元素都有平滑的动画效果
- **粒子特效**：爆炸、冰冻等视觉特效
- **动态阴影**：实时计算和渲染元素阴影

### 3. 音频系统
- **背景音乐**：多首背景音乐随机播放
- **音效反馈**：攻击、爆炸、升级等操作都有音效反馈
- **音量控制**：用户可自定义音效和音乐音量

### 4. 移动端优化
- **自适应布局**：界面根据屏幕尺寸自动调整
- **触摸优化**：专为移动设备优化的交互方式
- **性能调优**：针对移动设备进行性能优化

---

## 技术亮点

### 1. 前端架构
- **组件化设计**：高度模块化的组件结构
- **状态管理**：使用Pinia进行集中状态管理
- **路由管理**：Vue Router实现单页应用导航
- **类型安全**：全面使用TypeScript确保代码质量

### 2. 游戏引擎
- **游戏循环**：使用requestAnimationFrame实现流畅的游戏循环
- **碰撞检测**：精确的圆形碰撞检测算法
- **寻路系统**：预定义的敌人路径系统
- **特效系统**：可扩展的粒子特效系统

### 3. 性能优化
- **资源预加载**：游戏启动时预加载所有必要资源
- **对象池**：复用游戏对象减少内存分配
- **渲染优化**：只重绘变化区域，提高渲染效率
- **代码分割**：按需加载减少初始包体积

---

## 文件结构

```
src/
├── assets/              # 静态资源
├── components/          # 公共组件
│   ├── AdminDashboard.vue   # 后台管理面板组件
│   ├── coverCanvas.vue      # 关卡封面画布组件
│   ├── enemyInfoPop.vue      # 敌人信息弹窗组件
│   ├── floatingBall.vue     # 浮动球组件基类
│   ├── gitHubBall.vue       # GitHub链接球组件
│   ├── loading.vue         # 加载组件
│   ├── login.vue           # 登录组件
│   ├── rankList.vue        # 排行榜组件
│   ├── scrollCircle/       # 滚动圆圈组件
│   ├── selectLevelPop.vue  # 选择关卡弹窗组件
│   ├── selectTips.vue      # 选择提示组件
│   ├── selectTowerPop.vue  # 选择塔防弹窗组件
│   ├── towerCanvas.vue     # 塔防画布组件
│   ├── toolsFolder/       # 工具文件夹组件
│   ├── userBall.vue       # 用户信息球组件
│   └── userInfo.vue       # 用户信息组件
├── config/              # 配置文件
│   ├── index.ts            # API配置
│   └── supabase.ts         # Supabase数据库配置
├── dataSource/          # 游戏数据源
│   ├── audioData.ts         # 音频数据
│   ├── enemyData.ts         # 敌人数据
│   ├── levelData.ts         # 关卡数据
│   ├── mapData.ts           # 地图数据
│   ├── otherImgData.ts      # 其他图片数据
│   ├── skillData.ts         # 技能数据
│   └── towerData.ts         # 塔防数据
├── hooks/               # 自定义 Hooks
├── router/              # 路由配置
├── service/             # API 服务
│   ├── adminService.ts    # 后台管理服务
│   ├── login.ts            # 登录注册服务
│   ├── rank.ts            # 排行榜服务
│   ├── supabaseService.ts # Supabase数据库服务
│   └── userInfo.ts        # 用户信息服务
├── stores/              # 状态管理
├── type/                # 类型定义
├── utils/               # 工具函数
│   └── adminAuth.ts      # 管理员认证工具
├── views/               # 页面视图
│   ├── admin/            # 管理后台页面
│   │   └── index.vue     # 管理后台主界面
│   ├── index.vue           # 首页
│   └── gameWorker/        # 游戏工作区
│       ├── components/     # 游戏组件
│       └── workers/        # Web Workers
├── App.vue              # 根组件
└── main.ts              # 入口文件
```

---

## 开发与部署

### 开发环境
```bash
# 安装依赖
npm install

# 开发模式
npm run dev

# 类型检查
npm run tsc
```

### 生产构建
```bash
# 构建生产版本
npm run build
```

### 服务器配置
- **开发服务器**：默认运行在 http://localhost:16666
- **数据库服务**：使用 Supabase PostgreSQL 数据库
- **API接口**：所有用户数据通过 Supabase API 处理
- **静态资源**：CDN托管静态游戏资源

### 数据库配置
- **数据库类型**：Supabase (PostgreSQL)
- **主要表结构**：
  - `users` 表：存储用户账户信息
  - `game_scores` 表：存储游戏分数记录
- **安全特性**：行级安全策略(RLS)确保数据访问安全
- **测试账号**：
  - 用户名：testuser1，密码：password123
  - 用户名：testuser2，密码：password456
  - 用户名：testuser3，密码：password789

---

## 未来规划

### 短期优化
1. **性能优化**：进一步优化渲染性能，支持更多敌人
2. **后台管理增强**：添加批量操作、数据可视化等高级功能
3. **内容扩展**：增加更多关卡和防御塔类型
4. **平衡调整**：根据玩家反馈调整游戏平衡性
5. **BUG修复**：修复已知问题，提高稳定性

### 长期规划
1. **多人模式**：开发合作或对战模式
2. **塔防编辑器**：允许玩家自定义地图
3. **高级后台管理**：实现数据分析、用户行为追踪等功能
4. **成就系统**：增加成就收集和奖励机制
5. **社交功能**：好友系统和排行榜功能增强
6. **安全升级**：实现JWT认证、IP白名单等安全机制

---

## 技术支持

- **作者**：yx
- **邮箱**：1829738634@qq.com
 
---

本文档详细介绍了LegendTD塔防游戏的功能特性、技术实现和系统架构，为开发者和用户提供全面的项目理解。如有任何问题或建议，欢迎联系作者。